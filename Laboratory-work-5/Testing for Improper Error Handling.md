# Тестування на неналежну обробку помилок
## Висновок
Всі типи додатків (веб-додатки, веб-сервери, бази даних тощо) генерують помилки з різних причин. Розробники часто ігнорують обробку цих помилок або відштовхують думку про те, що користувач коли-небудь спробує викликати помилку цілеспрямовано (наприклад, надсилаючи рядок замість цілого числа, яке очікується). Коли розробник розглядає тільки щасливий шлях, він забуває про всі інші можливі вхідні дані користувача, які код може отримати, але не може обробити.

Помилки іноді виникають у вигляді
- трасування стеку,
- мережеві таймаути,
- невідповідність вводу,
- та дампи пам'яті.
Неправильна обробка помилок може дозволити зловмисникам це зробити:

- Зрозуміти API, що використовуються всередині організації.
- Скласти карту різних сервісів, що інтегруються один з одним, отримавши уявлення про внутрішні системи та фреймворки, які використовуються, що відкриває двері для ланцюгової атаки.
- Зберіть версії і типи використовуваних додатків.
- DoS системи, змушуючи систему зайти в глухий кут або необроблений виняток, який посилає сигнал паніки двигуну, що її запускає.
- Контролює обхід, коли певний виняток не обмежується логікою, встановленою навколо щасливого шляху.

## Цілі випробувань
- Визначити існуючі помилки у виводі.
- Проаналізувати різні результати, що повертаються.


## Як протестувати
Помилки зазвичай розглядаються як доброякісні, оскільки вони надають діагностичні дані та повідомлення, які можуть допомогти користувачеві зрозуміти проблему, що виникла, або розробнику налагодити цю помилку.
Намагаючись надіслати неочікувані дані або змусити систему працювати в певних граничних ситуаціях та сценаріях, система або програма в більшості випадків видасть трохи інформації про те, що відбувається всередині, якщо тільки розробники не вимкнули всі можливі помилки та не повернуть певне спеціальне повідомлення.

### Веб-сервери
Всі веб-додатки працюють на веб-сервері, незалежно від того, інтегрований він чи повноцінний. Веб-додатки повинні обробляти та аналізувати HTTP-запити, і для цього веб-сервер завжди є частиною стеку. Одними з найвідоміших веб-серверів є NGINX, Apache та IIS.

Веб-сервери мають відомі повідомлення про помилки та формати. Якщо хтось не знайомий з тим, як вони виглядають, пошук в Інтернеті може надати приклади. Інший спосіб - ознайомитися з їхньою документацією або просто встановити сервер локально і виявити помилки, переглядаючи сторінки, які використовує веб-сервер.

Для того, щоб викликати повідомлення про помилки, тестувальник повинен:

- Шукати випадкові файли і папки, які не будуть знайдені (404).
- Спробувати запросити папки, які існують, і подивитися на поведінку сервера (403s, порожня сторінка або список каталогів).
- Спробуйте відправити запит, який порушує HTTP RFC. Одним з прикладів може бути відправка дуже великого шляху, порушення формату заголовків або зміна версії HTTP.
- Навіть якщо помилки обробляються на рівні програми, порушення HTTP RFC може змусити інтегрований веб-сервер проявити себе, оскільки він повинен обробити запит, а розробники забувають перевизначити ці помилки.


### Застосування
Додатки найбільш схильні до видачі різноманітних повідомлень про помилки, до яких відносяться: трасування стеку, дампи пам'яті, неправильно оброблені виключення та типові помилки. Це відбувається через те, що додатки здебільшого створюються на замовлення і розробникам необхідно спостерігати і обробляти всі можливі випадки помилок (або мати глобальний механізм перехоплення помилок), а також ці помилки можуть з'являтися в результаті інтеграції з іншими сервісами.

Для того, щоб змусити додаток видавати ці помилки, тестувальник повинен:

1) Визначити можливі точки введення, де додаток очікує дані.
2) Проаналізувати очікуваний тип вхідних даних (рядки, цілі числа, JSON, XML і т.д.).
3) Розмити кожну точку вводу на основі попередніх кроків, щоб мати більш сфокусований сценарій тестування.
 - Нечіткість кожного введення з усіма можливими ін'єкціями не є найкращим рішенням, якщо у вас немає необмеженого часу тестування, і програма може обробляти таку кількість вхідних даних.
- Якщо нечіткість не є варіантом, виберіть життєздатні вхідні дані, які мають найбільший шанс зламати певний синтаксичний аналізатор (наприклад, закриваюча дужка для тіла JSON, великий текст, де очікується лише пара символів, ін'єкція CLRF з параметрами, які можуть бути оброблені серверами і елементами управління перевіркою введення, спеціальні символи, які не застосовуються для імен файлів, і т. д.).
- Фаззінг з жаргонними даними слід виконувати для кожного типу, оскільки іноді інтерпретатори можуть виходити за межі обробки винятків, передбачених розробником.
4) Зрозумійте, який сервіс відповідає повідомленням про помилку, і спробуйте скласти більш досконалий список нечітких даних, щоб отримати більше інформації або деталей помилки від цього сервісу (це може бути база даних, окремий сервіс і т.д.).
Повідомлення про помилки іноді є основним слабким місцем у відображенні систем, особливо в рамках мікросервісної архітектури. Якщо сервіси не налаштовані належним чином для обробки помилок в загальному і одноманітному порядку, повідомлення про помилки дозволять тестеру визначити, який сервіс обробляє які запити, і дозволить більш цілеспрямовано атакувати кожний сервіс.

Тестувальник повинен пильно стежити за типом відповіді. Іноді помилки повертаються як успіх з тілом помилки, приховують помилку в 302, або просто за допомогою спеціального способу представлення цієї помилки.
